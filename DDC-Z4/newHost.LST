C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 1   


C51 COMPILER V9.51, COMPILATION OF MODULE NEWHOST
OBJECT MODULE PLACED IN newHost.OBJ
COMPILER INVOKED BY: D:\Program Files (x86)\keil\C51\BIN\C51.EXE newHost.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //µç¶¯³µ
   2          #include"N79E81x.h"
   3          #include<intrins.h>
   4          #include"AD.h"
   5          #include"UART.h"
   6          #include"T0.h"
   7          #include"voice.h"
   8          #include"pwm.h"
   9          #include"T1.h"
  10          
  11          //¶¨ÒåÍ¨ĞÅÃüÁî
  12          #define CmdStart 0x00 //¿ª»úÃüÁî
  13          #define CmdStop 0x01  //¹Ø»úÃüÁî
  14          #define ComMode_1 0xc1 //Í¨ĞÅÄ£Ê½1 
  15          #define ComMode_2 0xc2 //Í¨ĞÅÄ£Ê½2
  16          #define ComMode_3 0xc3 //Í¨ĞÅÄ£Ê½3
  17          #define ComMode_4 0xc4 //Ì§ÆğÖ¸Áî
  18          #define ComMode_5 0xc5//µ¹µØÖ¸Áî
  19          #define ComMode_6 0xc6  //³äµçÒÑÂúÖ¸Áî
  20          #define Succeed 0xce  //Í¨ĞÅ³É¹¦
  21          #define Wrong 0xff    //Í¨ĞÅÊ§°Ü
  22          #define CmdHead 0xc8
  23          #define CmdHead1 0x33 //Êı¾İÖ¡µÄÊ×²¿1, 00110011,11
  24          #define CmdHead2 0xcc //Êı¾İÖ¡µÄÊ×²¿2,11001100,00
  25          #define CmdHead3 0x3c //Êı¾İÖ¡µÄÊ×²¿3,11000011,01
  26          #define CmdHead4 0xcc //Êı¾İÖ¡µÄÊ×²¿4,11001100,00
  27          #define MyAddress 0xe0
  28          #define MyAddress1 0x33 //±¾»úµØÖ·1, 00110011,11
  29          #define MyAddress2 0x3c //±¾»úµØÖ·2, 11000011,01
  30          #define MyAddress3 0xcc //±¾»úµØÖ·3,11001100,00
  31          #define MyAddress4 0xcc //±¾»úµØÖ·4,11001100,00
  32          
  33          //ÉèÖÃ±¨µçÁ¿µÄ°´Å¥£¬1µÄÊ±ºò±¨Ò»ÏÂµçÁ¿£¬0µÄÊ±ºòÎª³£Ì¬
  34          sbit det_battery=P2^4;                  
  35          
  36          //ÉèÖÃ³äµçÖ¸Ê¾
  37          //sbit det_charge=P0^2;
  38          //Ö÷»úµÄ·¢Éä²¿·ÖµÄ¿ØÖÆ¶Ë¿Ú
  39          //sbit PWMout=P0^1;//·¢Éä»úµÄ·½²¨Êä³ö¿Ú£¬Ê¹ÓÃÍâÉèPWM
  40          sbit ModeControl_1=P2^6;//·¢Éä»úÄ£Ê½¿ØÖÆ,0ÁÁÎª30MÄ£Ê½£¬1ÃğÎª300MÄ£Ê½
  41          sbit tran_en=P2^7;//·¢Éä»ú¿ª¹Ø£¬1ÁÁÎª¿ªÁË£¬0ÃğÎª¹ØÁË
  42          
  43          //ÈıÖá´«¸ĞÆ÷
  44          sbit ReceWave=P0^7;//ÈıÖá´«¸ĞÆ÷ÊäÈë¶Ë
  45          sbit SensorControl=P2^5;//ÈıÖá´«¸ĞÆ÷¿ØÖÆ¶Ë
  46          
  47          //µç´ÅÌú,  Æ½Ê±ÖµÎª00£¬¿ªËøÓÃ10£¬¹ØËøÓĞ01£¬È»ºó¶¼»Ö¸´µ½00
  48          sbit MagentControl_1=P2^2;
  49          sbit MagentControl_2=P2^3;
  50          
  51          //Ê°ÒôÆ÷¿ØÖÆ ADµÄ6ºÅÍ¨µÀÎªÊ°ÒôÆ÷µÄÒôÁ¿¼ì²é¶Ë
  52          //sbit VoiceControl=P2^4;//Ê°ÒôÆ÷¿ØÖÆ¶Ë
  53          
  54          sbit upSignal=P0^4;//Ì§ÆğĞÅºÅ
  55          sbit downSignal=P0^3;//µ¹µØĞÅºÅ
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 2   

  56          
  57          //µç³Ø¿ØÖÆ      ADµÄ1ºÅÍ¨µÀÎªµç³ØµÄµçÁ¿¼ì²â¶Ë
  58          sbit BatteryControl=P1^2;
  59          
  60          unsigned char count=0;//Êı¾İ½ÓÊÕ²¿·ÖµÄ¼ÆÊıÆ÷
  61          
  62          unsigned int lastAddr=0;//ÉÏÒ»´Î½ÓÊÕµ½µÄ±àÂëµÄµØÖ·
  63          
  64          unsigned char time0Count_1=0;//×÷ÎªÈıÖá´«¸ĞÆ÷Á½¸öÂö³åÖ®¼äµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  65          unsigned char time0Count_2=0;//×÷ÎªÈıÖá´«¸ĞÆ÷µÄ¼ÆÊ±
  66          unsigned char time0Count_6=0;
  67          unsigned int time0Count_3=0;//×÷Îª´®¿ÚÃ¿ÃëÖ÷¸¨»úµÄĞÅÏ¢½»»¥Ê±ÖÓ
  68          unsigned char time0Count_4=0;//×÷ÎªÌ§ÆğÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  69          unsigned char time0Count_5=0;//×÷Îªµ¹µØÂö³åµÄÊ±¼ä¼ä¸ô¼ÆÊ±
  70          
  71          bit SensorFlag=0; //ÈıÖá´«¸ĞÆ÷µÄµÍµçÆ½±êÖ¾Î»
  72          unsigned char  SensorCount=0; //×÷ÎªÈıÖá´«¸ĞÆ÷Âö³åµÄ¼ÆÊı
  73          
  74          unsigned char TestFlag=0;//1¡¢2¡¢3·Ö±ğÎªÃ¿´Î½ÓÊÕµ½¸½»ú·¢ËÍÀ´Êı¾İºóµÄ¼ÆÊı£¬ÔÚ´®¿ÚµÄ³É¹¦Ö¸ÁîÀï»áÖ´ĞĞ½«È¥¹éÁã
             -µÄ²Ù×÷
  75                          //Èç¹ûÁ¬Ğø3´Î¶¼Ã»ÓĞ¹éÁã£¬ÔòËµÃ÷²»ÔÚ³¡ÁË
  76          unsigned char ModeFlag=1;//Ä£Ê½Ñ¡ÔñÎ»£¬1ÔòÓÃÄ£Ê½1,2ÔòÓÃÄ£Ê½2,3ÔòÎªÄ£Ê½3
  77          
  78          bit alarmFlag=0;//±¨¾¯ÓïÒôµÄ¿ªÆô±êÖ¾
  79          bit alarmFlag2=0;//±¨¾¯ÓïÒô±êÖ¾2
  80          //unsigned int alarmCount=0;//±¨¾¯ÓïÒôµÄ´ÎÊı
  81          
  82          bit threeFlag=0;//ÈıÂ·Ñ­»·¿ª¹Ø±êÖ¾
  83          
  84          bit power1Flag=0;
  85          bit power2Flag=0;
  86          bit power3Flag=0;
  87          bit power4Flag=0;
  88          
  89          bit voiceFlag=0;
  90          bit downUpFlag=0;  //µ¹µØºÍÌ§Æğ¼ì²â±êÖ¾
  91          
  92          bit downFlag=0;//µ¹µØµÄ±êÖ¾
  93          unsigned char downcount=0;
  94          bit upFlag=0;//Ì§ÆğµÄ±êÖ¾
  95          unsigned char upcount=0;
  96          bit downFlagSend=0;//µ¹µØ·¢ËÍµÄ±êÖ¾
  97          bit upFlagSend=0;//Ì§Æğ·¢ËÍµÄ±êÖ¾
  98          
  99          //Ò»¸öÍ·×Ö½Ú£¬Ò»¸öµØÖ·×Ö½Ú£¬Ò»¸öÃüÁî×Ö½Ú£¬Á½¸ö±àÂëµØÖ·×Ö½Ú£¬Á½¸ö±àÂë
 100          unsigned char myTxRxData[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x00};//´¦ÀíÍêºóµÄÍ¨ĞÅÊı¾İµÄ»º³åÇø
 101          unsigned char myTxRxData2[7]={0x00,0x00,0x00,0x00,0x00,0x00,0x00};
 102          unsigned int Check=0;//µçÁ¿¼ì²â
 103          //unsigned char Check1=0;//×÷ÎªAD¼ì²âÖµ
 104          
 105          bit receiveFlag=0;//½ÓÊÕµ½Êı¾İ±êÖ¾
 106          bit commuFlag=0;//¿ªÆôÍ¨ĞÅ±êÖ¾
 107          
 108          unsigned char DataBetween=0;//×÷Îª½ÓÊÕÊı¾İµÄÖĞ¼ä±äÁ¿
 109          unsigned char RecData=0;//½ÓÊÕµ½µÄÊı¾İ
 110          unsigned char DataTime=0;//×÷Îª½ÓÊÕµÄÊı¾İµÄÒÆÎ»´ÎÊı¼ÆÊı
 111          bit ComFlag=1;//×öÉÏÉıÑØµÄÒ»¸ö±êÖ¾
 112          //unsigned int newAddr=0;
 113          unsigned char T1highcount=0;       //¶¨Ê±Æ÷T1ÔÚÃ»ÓĞĞÅºÅµ½À´µÄÊ±ºò£¬¶Ô¸ßµçÆ½¼ÆÊı£¬Ò»µ©³¬¹ıÄ³¸öÖµ£¬Ôò½«Datatime
             -Çå0
 114          
 115          //¹¦·Å¿ª¹Ø¿ØÖÆ£¬1Îª´ò¿ª¹¦·Å£¬0Îª¹Ø±Õ¹¦·Å
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 3   

 116          sbit PAshutdown=P1^4;
 117          
 118          //¶¨Òåµç´ÅÌú×ª¶¯Óë·ñ
 119          unsigned char magnetflag=0;
 120          
 121          //¶¨ÒåÒ»¸ö¼ÆÊı£¬À´±íÊ¾ĞÅºÅ½ÓÊÕºó£¬¶à³¤Ê±¼äÊ¹½ÓÊÕ»ú´ò¿ª£¬¼´¿ØÖÆSwitchControlµÄ¸ßµçÆ½Ê±¼ä¡£
 122          //unsigned int SwitchControlcount=0;
 123          
 124          //·¢ËÍ±àÂëĞÅºÅ±êÖ¾Î»
 125          //unsigned char commode2_flag=0; //·¢ËÍ±àÂë2µÄ±êÖ¾Î»
 126          //unsigned char commode3_flag=0; //·¢ËÍ±àÂë3µÄ±êÖ¾Î»
 127          
 128          bit ADCcheck=0;                 //ÖÃ1Ê±£¬Ö´ĞĞÒ»´ÎµçÁ¿×ª»»£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 129          bit sendcomm1=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë1£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 130          bit sendcomm3=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë3£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 131          bit sendcomm4=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë4£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 132          bit sendcomm5=0;                //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î·¢ËÍ±àÂë5£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 133          bit magcon=0;                   //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Îµç´ÅÌúËøÉÏ²Ù×÷£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 134          bit magcon2=0;                  //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Îµç´ÅÌú´ò¿ª²Ù×÷£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 135          bit sendspeech1=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨±»Åö¾¯¸æ£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 136          unsigned char speech1_count=0;
 137          bit sendspeech2=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨¾¯µÑÒô+±¨¾¯£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 138          bit sendspeech3=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨±»Åö¾¯¸æ£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 139          unsigned int speech3_count=0;
 140          bit sendspeech4=0;              //ÖÃ1Ê±£¬Ö´ĞĞÒ»´Î±¨ÓïÒô£¨¾¯µÑÒô+±¨¾¯£©£¬Ö´ĞĞÍêºó£¬½«ÆäÖÃ0
 141          bit sendspeech5=0;
 142          bit sendspeech6=0;
 143          bit sendspeech7=0;
 144          unsigned char speech7_count=0;
 145          bit sendspeech8=0;
 146          unsigned char speech8_count=0;
 147          
 148          bit stolenflag=0;               //±»µÁ±êÖ¾Î»
 149          unsigned int stolen_count=0;    //±»µÁ¼ÆÊıµÄÊ±¼ä
 150          unsigned char stolen_flag=0;    //¼ì²â´«¸ĞÆ÷¿ªÊ¼±êÖ¾
 151          
 152          unsigned char turnonflag=0;             //µç¶¯³µ¿ªÆô¹Ø±Õ±êÖ¾Î»£¬1±íÊ¾µç¶¯³µ¿ªÆôÁË£¬0±íÊ¾µç¶¯³µ¹Ø±ÕÁË
 153          unsigned char turnon_speech_flag=0;             //¿ª»úÓïÒô±êÖ¾Î»£¬ÓÃÀ´±ä»»ÓïÒô¡£
 154          
 155          //º¯ÊıÉùÃ÷
 156          //void ComMode_1_Data(unsigned int sendAddr);   //·¢ËÍÄ£Ê½1±àÂë
 157          void ComMode_1_Data(void);      //·¢ËÍÄ£Ê½1±àÂë
 158          void ComMode_2_Data(void);//·¢ËÍÄ£Ê½2±àÂë
 159          void ComMode_3_Data(void);//·¢ËÍÄ£Ê½3±àÂë
 160          void ComMode_4_Data(void);//·¢ËÍÌ§Æğ±àÂë
 161          void ComMode_5_Data(void);//·¢ËÍµ¹µØ±àÂë
 162          void ComMode_6_Data(void);//·¢ËÍ³äµçÒÑÂú±àÂë
 163          void verifybattery(void);
 164          
 165          //void codeData(unsigned char *doData,unsigned char len);               //±àÂë ,µçÆ½1±äÎª0011£¬µçÆ½0±äÎª1100
 166          //void transCode(unsigned char *doData,unsigned char len);//½âÂë£¬½«½ÓÊÕµ½µÃÊı¾İ»¹Ô­
 167          
 168          //t=1Ê±£¬ÑÓ³Ù100us×óÓÒ
 169          void Delay3(unsigned int t)
 170          {
 171   1              unsigned int i,j;
 172   1              for(i=0;i<t;i++)                
 173   1              for(j=0;j<19;j++);
 174   1      }
 175          void Delay4(unsigned int t)
 176          {
 177   1              unsigned int i,j;
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 4   

 178   1              for(i=0;i<t;i++)                
 179   1              for(j=0;j<26;j++);
 180   1      }
 181          
 182          //init signal£¬·¢ËÍ±àÂëĞÅºÅÇ°µÄÆğÊ¼ĞÅºÅ£¬ÓÃÓÚ½«½ÓÊÕ»úµÄ×Ô¶¯ÔöÒæ´ò¿ª
 183          void initsignal()
 184          {
 185   1              unsigned char k,k1;
 186   1              unsigned char mystartbuffer=0xaa;
 187   1              for(k1=0;k1<3;k1++)
 188   1              {
 189   2                      for(k=0;k<8;k++)
 190   2                      {
 191   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 192   3                              {
 193   4                                      P10=0;
 194   4                                      Delay3(80);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 195   4                              }
 196   3                              else//Îª0µÄÇé¿ö
 197   3                              {
 198   4                                      P10=0;
 199   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 200   4                              }
 201   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 202   3                              mystartbuffer<<=1;
 203   3                              Delay3(150);//ÑÓÊ±Òª´óÓÚ2ms
 204   3                      }
 205   2                      mystartbuffer=0xaa;
 206   2                      Delay3(80);
 207   2              }
 208   1              P10=1;
 209   1      //      Delay3(80);
 210   1      }
 211          
 212          void initsignal2()
 213          {
 214   1              unsigned char k,k1;
 215   1              unsigned char mystartbuffer=0xaa;
 216   1              for(k1=0;k1<3;k1++)
 217   1              {
 218   2                      for(k=0;k<8;k++)
 219   2                      {
 220   3                              if((mystartbuffer&0x80)==0x80)//Îª1
 221   3                              {
 222   4                                      P10=0;
 223   4                                      Delay3(80);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 224   4                              }
 225   3                              else//Îª0µÄÇé¿ö
 226   3                              {
 227   4                                      P10=0;
 228   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 229   4                              }
 230   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 231   3                              mystartbuffer<<=1;
 232   3                              Delay3(150);//ÑÓÊ±Òª´óÓÚ2ms
 233   3                      }
 234   2                      mystartbuffer=0xaa;
 235   2                      Delay3(80);
 236   2              }
 237   1              P10=1;
 238   1      //      Delay3(80);
 239   1      }
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 5   

 240          
 241          void main()
 242          {
 243   1              SensorControl=0;                  //ÉÏµç¹Ø±Õ´«¸ĞÆ÷
 244   1      
 245   1              noVoice();
 246   1              InitT0();
 247   1              InitT1();
 248   1              
 249   1              PAshutdown=0;           //½«¹¦·Å¹Ø±Õ
 250   1      
 251   1              upSignal=1;
 252   1              downSignal=1;
 253   1              ET0=1;  //¿ªÆô¶¨Ê±Æ÷0ÖĞ¶Ï
 254   1              ET1=1; //¿ªÆô¶¨Ê±Æ÷1ÖĞ¶Ï
 255   1              PT1=1;//¶¨Ê±Æ÷1µÄÖĞ¶ÏÓÅÏÈ¼¶×î¸ß
 256   1              EA=1;
 257   1              P10=1;
 258   1      //      det_charge=1;
 259   1      
 260   1              BatteryControl=0;       //¸½»úÉÏµçµÄÊ±ºòÖÃ0£¬¼´¿ÉÒÔ³äµç£¬µç³ØÔÚÃ»ÓĞ³äÂúµÄÇé¿öÏÂÎªµÍµçÆ½
 261   1              myPwm();        //¿ª·¢Éä»ú
 262   1      
 263   1              ModeControl_1=0; //·¢Éä»úÄ£Ê½¿ØÖÆ¶Ë,¿ª»úÊ±Îª30MÄ£Ê½
 264   1              
 265   1      //      MagentControl_1=0;//¹Ø±Õ´ÅÌú
 266   1      //      MagentControl_2=1;
 267   1      //      Delay(50);
 268   1      //      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 269   1      //      MagentControl_2=0;
 270   1              magnetflag=0;
 271   1      
 272   1              commuFlag=1; //¿ªÆôÍ¨ĞÅ
 273   1              tran_en=0;   //¹Ø±ÕÎŞÏß·¢Éä»ú
 274   1      
 275   1              downUpFlag=1;
 276   1              det_battery=1;
 277   1      
 278   1              while(1)
 279   1              {
 280   2                      if((det_battery==1)&&(turnonflag==0))              //¿ª³µ×ª¶¯Ô¿³×Ê±£¬Ö´ĞĞÒ»´ÎµçÁ¿×ª»»
 281   2                      {
 282   3                              Delay(30);
 283   3                              if(det_battery==1)
 284   3                              {
 285   4                                      verifybattery();
 286   4                                      PAshutdown=1;
 287   4                                      SC_Speech(7);  
 288   4                                      Delay(160);
 289   4                                      PAshutdown=0;
 290   4                                      
 291   4      /*                              if(turnon_speech_flag==0)
 292   4                                      {
 293   4                                              PAshutdown=1;
 294   4                                              SC_Speech(8);  
 295   4                                              Delay(80);
 296   4                                              PAshutdown=0;
 297   4                                              turnon_speech_flag=1;
 298   4                                      }
 299   4                                      else
 300   4                                      {
 301   4                                              PAshutdown=1;
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 6   

 302   4                                              SC_Speech(7);  
 303   4                                              Delay(240);
 304   4                                              PAshutdown=0;
 305   4                                              turnon_speech_flag=0;
 306   4                                      }
 307   4      */
 308   4                                      turnonflag=1;
 309   4                              }
 310   3                      }
 311   2                      
 312   2                      if((det_battery==0)&&(turnonflag==1))
 313   2                      {
 314   3                              Delay(30);
 315   3                              if(det_battery==0)
 316   3                              {
 317   4                                      verifybattery();
 318   4                                      if((Check<0x300))                                                 //Ğ¡ÓÚ38V±¨¾¯£¬Ğ¡ÓÚ5¹«ÀïÁË
 319   4                                      {
 320   5                                              PAshutdown=1;
 321   5                                              SC_Speech(10);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 322   5                                              Delay(100);
 323   5                                              PAshutdown=0;
 324   5                                      }
 325   4                                      PAshutdown=1;
 326   4                                      SC_Speech(9);
 327   4                                      Delay(130);
 328   4                                      PAshutdown=0;
 329   4                                      turnonflag=0;
 330   4                              }
 331   3                      }
 332   2      
 333   2                      if(ADCcheck==1)
 334   2                      {
 335   3                              Check=GetADCResult(6);  //µç³ØµçÁ¿¼ì²â
 336   3                              ADCcheck=0;     
 337   3                      }
 338   2      
 339   2                      if(magcon==1)
 340   2                      {
 341   3                              if(magnetflag==1)
 342   3                              {
 343   4                                      MagentControl_1=1;//¹Ø±Õ´ÅÌú
 344   4                                      MagentControl_2=0;
 345   4                                      Delay(40);
 346   4                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 347   4                                      MagentControl_2=0;
 348   4                                      magnetflag=0;
 349   4                              }
 350   3                              magcon=0;
 351   3                      }
 352   2      
 353   2                      if(magcon2==1)
 354   2                      {
 355   3                              if(magnetflag==0)
 356   3                              {
 357   4                                      MagentControl_1=0;//¿ªÆô´ÅÌú
 358   4                                      MagentControl_2=1;
 359   4                                      Delay(40);
 360   4                                      MagentControl_1=0;//´ÅÌú³£Ì¬ÎªÕâÖÖÄ£Ê½
 361   4                                      MagentControl_2=0;
 362   4                                      magnetflag=1;
 363   4                              }
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 7   

 364   3                              magcon2=0;
 365   3                      }
 366   2      /*
 367   2                      if(sendspeech1==1)
 368   2                      {
 369   2                              PAshutdown=1;
 370   2                              SC_Speech(17);  //¹Ø»úÓïÑÔÌáĞÑ
 371   2                              Delay(80);
 372   2                              PAshutdown=0;
 373   2                              sendspeech1=0;
 374   2                      }
 375   2      */
 376   2      /*
 377   2                      if(sendspeech2==1)
 378   2                      {
 379   2                              PAshutdown=1;
 380   2                              SC_Speech(18);  //¹Ø»úÓïÑÔÌáĞÑ
 381   2                              Delay(100);
 382   2                              SC_Speech(16);  //¹Ø»úÓïÑÔÌáĞÑ
 383   2                              Delay(100);
 384   2                              PAshutdown=0;
 385   2                              sendspeech2=0;
 386   2                      }
 387   2      */
 388   2                      if((sendspeech3==1)&&(speech3_count<4))
 389   2                      {
 390   3                              if((upSignal==1)&&(downSignal==1))
 391   3                              {
 392   4                                      PAshutdown=1;
 393   4                                      SC_Speech(22);  //¹Ø»úÓïÑÔÌáĞÑ
 394   4                                      ComMode_3_Data();
 395   4                                      Delay(100);
 396   4                                      SC_Speech(23);  //¹Ø»úÓïÑÔÌáĞÑ          
 397   4                                      ComMode_3_Data();
 398   4                                      Delay(60);
 399   4                                      PAshutdown=0;
 400   4                              }
 401   3                              speech3_count++;
 402   3                              if(speech3_count==4)
 403   3                              {
 404   4                                      speech3_count=0;
 405   4                                      sendspeech3=0;
 406   4                                      stolenflag=0;
 407   4                              }
 408   3                      }
 409   2      
 410   2      /*              if(sendspeech3==1)
 411   2                      {
 412   2                              PAshutdown=1;
 413   2                              SC_Speech(18);  //¹Ø»úÓïÑÔÌáĞÑ
 414   2                              Delay(120);
 415   2                              SC_Speech(19);  //¹Ø»úÓïÑÔÌáĞÑ
 416   2                              Delay(140);
 417   2                              SC_Speech(20);  //¹Ø»úÓïÑÔÌáĞÑ
 418   2                              Delay(170);
 419   2                              PAshutdown=0;
 420   2                              sendspeech3=0;
 421   2                      }
 422   2      */
 423   2                      if((sendspeech7==1)&&(speech7_count<1))
 424   2                      {
 425   3                                      sendspeech8=0;
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 8   

 426   3                                      speech8_count=0;
 427   3                                      
 428   3                                      PAshutdown=1;
 429   3                                      SC_Speech(11);  //¹Ø»úÓïÑÔÌáĞÑ
 430   3                                      Delay(150);
 431   3                                      PAshutdown=0;
 432   3                                      speech7_count++;
 433   3                      }
 434   2      
 435   2                      if((sendspeech8==1)&&(speech8_count<1))
 436   2                      {
 437   3                                      sendspeech7=0;
 438   3                                      speech7_count=0;
 439   3                                      
 440   3                                      PAshutdown=1;
 441   3                                      SC_Speech(12);  
 442   3                                      Delay(80);
 443   3                                      SC_Speech(13);
 444   3                                      Delay(80);
 445   3                                      PAshutdown=0;
 446   3                                      speech8_count++;
 447   3                                      SensorControl=1;        //¿ªÆôÈıÖá´«¸ĞÆ÷
 448   3                      }
 449   2              }
 450   1      }
 451          
 452          void timeT1() interrupt 3 //¶¨Ê±Æ÷1ÖĞ¶Ï½ÓÊÕÊı¾İ
 453          {
 454   1      
 455   1              TH1=timer1H;//ÖØ×°ÔØ
 456   1              TL1=timer1L;
 457   1              
 458   1              if(P11==0)//Õı³£Çé¿öÎª¸ßµçÆ½,ÓĞµÍµçÆ½ËµÃ÷ÓĞĞÅºÅ
 459   1              {
 460   2                      DataBetween++;
 461   2                      ComFlag=0;
 462   2                      if(DataBetween==150)//µÍµçÆ½³ÖĞøµÄ×î´óÊ±¼ä      
 463   2                      {
 464   3                              DataBetween=0;
 465   3                      }
 466   2              }
 467   1              else//Îª¸ßµçÆ½ÁË
 468   1              {
 469   2                      if(ComFlag==0)//ËµÃ÷ÓĞÒ»¸öµÍµçÆ½
 470   2                      {
 471   3                              ComFlag=1;
 472   3      
 473   3                              if((DataBetween>60)&&(DataBetween<=100))        //µÍµçÆ½³ÖĞøµÄÊ±¼äĞ¡ÓÚ10ms£¬ÔòÎª0
 474   3                              {
 475   4                                      RecData<<=1;
 476   4                                      RecData &= 0xfe;
 477   4                                      DataTime++;
 478   4                                      T1highcount=0;
 479   4                              }
 480   3                              else if((DataBetween>100))//µÍµçÆ½³ÖĞøµÄÊ±¼ä´óÓÚ4.5ms£¬ÔòÎª1
 481   3                              {
 482   4                                      RecData<<=1;
 483   4                                      RecData |= 0x01;
 484   4                                      DataTime++;
 485   4                                      T1highcount=0;
 486   4                              }
 487   3                              else
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 9   

 488   3                              {
 489   4                                      T1highcount++;  
 490   4                              }
 491   3      
 492   3                              DataBetween=0;
 493   3                      }
 494   2      
 495   2                      else
 496   2                      {
 497   3                              T1highcount++;
 498   3                              if(T1highcount>=120)
 499   3                              {
 500   4                                      DataTime=0;
 501   4                                      ComFlag=1;
 502   4                                      count=0;
 503   4                              }               
 504   3                      }
 505   2              }
 506   1      
 507   1              if(DataTime==8)//ËµÃ÷Ò»¸ö×Ö½ÚµÄÊı¾İÒÑ¾­½ÓÊÜÍêÈ«
 508   1              {
 509   2                      DataTime=0;
 510   2                      myTxRxData2[count]=RecData;
 511   2                      if(count==0&&myTxRxData2[0]==CmdHead)
 512   2                      {
 513   3                              count=1;
 514   3                      }
 515   2                      else if(count==1&&myTxRxData2[1]==MyAddress)
 516   2                      {
 517   3                              count=2;
 518   3                      }
 519   2                      else if(count==2)
 520   2                      {
 521   3                              receiveFlag=1;
 522   3                              count=0;
 523   3                      }
 524   2                      else 
 525   2                      {
 526   3                              count=0;
 527   3                      }
 528   2      /*
 529   2                      else if(count>=2&&count<=5)
 530   2                      {
 531   2                              count++;
 532   2                      }
 533   2                      else if(count==6)
 534   2                      {
 535   2                          receiveFlag=1;
 536   2                              count=0;
 537   2                      }
 538   2                      else 
 539   2                      {
 540   2                              count=0;
 541   2                      }
 542   2      */
 543   2              }
 544   1      
 545   1              if(receiveFlag==1)
 546   1              {
 547   2                      receiveFlag=0;
 548   2                      switch(myTxRxData2[2])          //¶ÔÊı¾İÖ¡ÀïµÄÃüÁî½øĞĞ´¦Àí
 549   2                      {
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 10  

 550   3                              case ComMode_1:                 //¸½»ú·¢ËÍ¹ıÀ´µÄÖ»ÓÃÄ£Ê½1£¬ËµÃ÷ÏÖÔÚÊÇÕı³£µÄ£¬Êı¾İ²¿·ÖÎªÊı×éµÄµÚÒ»ºÍµÚ¶ş¸ö×Ö½Ú£¬ÎªÃÜÂ
             -ë±íÄÚµÄÕâ¸ö±àÂëµÄ¿ªÊ¼×Ö½ÚµÄÄÇ¸öµØÖ·£¬È»ºóÌî³äÊı¾İÖ¡£¬°ÑÃÜÂë±íµÄÊı¾İ·¢ËÍ³öÈ¥
 551   3                              {
 552   4      //                              sendcomm1=1;
 553   4                                      stolenflag=0;
 554   4                                      
 555   4                                      ComMode_1_Data();       //Ïò¸½»ú·¢ËÍ±àÂë3
 556   4      
 557   4                                      sendspeech7=1;          //±àÂë1ºó±¨Ò»¾äÓïÒô
 558   4      
 559   4      //                              sendspeech8=0;
 560   4      //                              speech8_count=0;
 561   4      
 562   4                                      alarmFlag=0;            //¹Ø±¨¾¯±êÖ¾Î»
 563   4      //                              alarmCount=0;           //±¨¾¯¼ÆÊı´ÎÊıÇåÁã
 564   4                                      SensorControl=0;        //ÈıÖá´«¸ĞÆ÷
 565   4                                      downUpFlag=0;           //¹Øµ¹µØ¡¢Ì§Æğ¼ì²â
 566   4                                      downFlag=0;
 567   4                                      upFlag=0;
 568   4                                      magcon2=1;                      //´ò¿ªµç´ÅÌú
 569   4                                      
 570   4                                      SensorCount=0;
 571   4                                      time0Count_2=0;
 572   4                                      stolen_count=0;
 573   4                                      stolen_flag=0;
 574   4                                      sendspeech1=0;
 575   4                                      sendspeech2=0;
 576   4                                      sendspeech3=0;
 577   4                                      speech3_count=0;
 578   4      
 579   4                                      TestFlag=0;     
 580   4                                      if(ModeFlag==3||ModeFlag==2)
 581   4                                      {
 582   5                                              ModeFlag=1;
 583   5                                      }
 584   4                              }
 585   3                              break;
 586   3                      }
 587   2              }
 588   1      }
 589          
 590          void time0() interrupt 1        //×÷ÎªÕû¸öÏµÍ³×Ô¼ºµÄÊ±ÖÓ
 591          {
 592   1              TH0=timer0H;//ÖØ×°ÔØ
 593   1              TL0=timer0L;
 594   1              time0Count_3++;
 595   1      
 596   1              if(time0Count_3>=2000)//´®¿ÚÃ¿3s½ÓÊÜÒ»´ÎµÄÊı¾İµÄÊ±¼ä±êÖ¾
 597   1              {
 598   2                      if(commuFlag==1)//ËµÃ÷¿ªÆôÁËÍ¨ĞÅ
 599   2                      {
 600   3                              TestFlag++;
 601   3      
 602   3                              if(TestFlag>=4&&ModeFlag==1)//ËµÃ÷Ã»ÓĞ½ÓÊÕµ½Êı¾İÒÑ¾­ÓĞ3´ÎÁË£¬¸½»úÒÑ¾­³öÁË3M£¬ÏÖÔÚ¾ÍÒª¼Ó´ó¹¦ÂÊ£¬ÇĞ»»µ½Ä£
             -Ê½2,30MÔÙ¿´ÄÜ²»ÄÜ½ÓÊÕµ½Êı¾İ
 603   3                              {
 604   4                                      TestFlag=5;
 605   4                                      if(ModeFlag==1)
 606   4                                      {
 607   5                                              magcon=1;                       //µç´ÅÌúËøÉÏ
 608   5                                              sendspeech8=1;          //±¨¸½»úÀë¿ªÓïÒô
 609   5                                              
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 11  

 610   5      //                                      sendspeech7=0;
 611   5      //                                      speech7_count=0;
 612   5      
 613   5      //                                      SensorControl=1;        //¿ªÆôÈıÖá´«¸ĞÆ÷
 614   5                                              downUpFlag=1;           //¿ªÆôµ¹µØ¡¢Ì§Æğ±êÖ¾
 615   5                                              ModeFlag=2;
 616   5      
 617   5                                              SensorCount=0;
 618   5                                              time0Count_2=0;
 619   5                                      }       
 620   4                              }
 621   3                      }
 622   2                      time0Count_3=0;
 623   2                      
 624   2      //              ComMode_1_Data();
 625   2      
 626   2                      ADCcheck=1;             
 627   2                      
 628   2                      if((downFlag==1)&&(downcount<5))  //µ¹µØºó×öÏàÓ¦µÄ¶¯×÷
 629   2                      {
 630   3      //                      sendcomm5=1;
 631   3                              ComMode_5_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 632   3                              downcount++;
 633   3                      }
 634   2                      if((upFlag==1)&&(upcount<5))            //Ì§Æğºó×öÏàÓ¦¶¯×÷
 635   2                      {
 636   3      //                      sendcomm4=1;
 637   3                              ComMode_4_Data(); //Ïò¸½»ú·¢ËÍ±àÂë3
 638   3                              upcount++;
 639   3                      }
 640   2      
 641   2      /*
 642   2              if((stolenflag==1)&&(speech3_count<4))
 643   2                      {
 644   2                              ComMode_3_Data();       
 645   2                      }
 646   2      */
 647   2              }
 648   1      
 649   1              if(SensorControl==1)    //¼ì²âÈıÖá´«¸ĞÆ÷ÊÇ·ñ´ò¿ª£¬²¢ÇÒ»¹Ã»ÓĞ±¨¾¯
 650   1              {
 651   2                      if((ReceWave==1)&&(stolenflag==0))
 652   2                      {
 653   3                              time0Count_2++;
 654   3                              if(time0Count_2>=8)                              //Ã¿1ms¼ì²âÒ»´Î¸ßµçÆ½£¬Èç¹û´óÓÚÁË6msµÄ¸ß¶¨Æ½£¬ËµÃ÷ÓĞÈËÅöÁËÒ»ÏÂ
 655   3                              {
 656   4                                      time0Count_2=0;
 657   4                                      SensorCount++;
 658   4                                      speech1_count=0;
 659   4                                      stolen_flag=1;
 660   4                              }
 661   3                      }
 662   2                      else
 663   2                      {
 664   3                              time0Count_2=0;
 665   3                      }
 666   2                      
 667   2                      if(stolen_flag==1)
 668   2                      {
 669   3                              stolen_count++;
 670   3                              if(stolen_count>=6000)
 671   3                              {
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 12  

 672   4                                      SensorCount=0;
 673   4                                      time0Count_2=0;
 674   4                                      stolen_count=0;
 675   4                                      stolen_flag=0;
 676   4                                      sendspeech1=0;
 677   4                                      speech1_count=0;
 678   4                                      sendspeech2=0;
 679   4                              }
 680   3                      }
 681   2              }
 682   1      
 683   1              if(SensorCount==1)
 684   1              {
 685   2      //              sendspeech1=1;
 686   2                      if((speech1_count<1)&&(sendspeech3!=1))
 687   2                      {
 688   3                              if((downSignal==1)&&(upSignal==1))
 689   3                              {
 690   4                                      PAshutdown=1;
 691   4                                      SC_Speech(17);  //¹Ø»úÓïÑÔÌáĞÑ
 692   4                                      Delay(80);
 693   4                                      PAshutdown=0;
 694   4                                      speech1_count++;
 695   4                              }
 696   3                      }
 697   2              }
 698   1              else
 699   1              {
 700   2                      if(stolen_count>=3000)
 701   2                      {
 702   3                              if(ReceWave==1)
 703   3                              {
 704   4                                      time0Count_6++;
 705   4                                      if(time0Count_6>=6)     
 706   4                                      {
 707   5                                              sendspeech3=1;
 708   5                                              speech3_count=0;
 709   5                                              stolenflag=1;
 710   5                                              time0Count_6=0; 
 711   5                                      }
 712   4                              }
 713   3                              else
 714   3                              {
 715   4                                      time0Count_6=0;
 716   4                              }
 717   3                      }                                                
 718   2              }
 719   1      
 720   1      //      ¼ì²âµ¹µØºÍÌ§Æğ¼ì²âµÄ´úÂë
 721   1              if(downUpFlag==1)//¿ªÆôÁËÌ§Æğµ¹µØ¼ì²â
 722   1              {
 723   2                      if(upSignal==0)//ËµÃ÷ÓĞÌ§ÆğĞÅºÅ²¢ÇÒÊÇµÚÒ»´Î£¬¿ªÊ¼¼ÆÊ±
 724   2                      {
 725   3                              time0Count_4++;
 726   3                              if(time0Count_4==10)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 727   3                              {
 728   4                                      upFlag=1;//ÖÃÌ§Æğ±êÖ¾
 729   4                                      downFlag=0;
 730   4                                      alarmFlag=0;
 731   4                              }               
 732   3                      }
 733   2                      else
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 13  

 734   2                      {
 735   3                              upFlag=0;
 736   3                              upcount=0;
 737   3                              time0Count_4=0;
 738   3                      }
 739   2      
 740   2                      if(downSignal==0)//ËµÃ÷ÓĞÌ§ÆğĞÅºÅ£¬¿ªÊ¼¼ÆÊ±
 741   2                      {
 742   3                              time0Count_5++;
 743   3                              if(time0Count_5==10)//ËµÃ÷ÒÑ¾­´óÓÚ0.5S
 744   3                              {
 745   4                                      downFlag=1;//ÖÃÌ§Æğ±êÖ¾
 746   4                                      upFlag=0;
 747   4                                      alarmFlag=0;
 748   4                              }               
 749   3                      }
 750   2                      else
 751   2                      {
 752   3                              downFlag=0;
 753   3                              downcount=0;
 754   3                              time0Count_5=0;
 755   3                      }
 756   2              }
 757   1      }
 758          
 759          
 760          void ComMode_1_Data()           //·¢ËÍ±ßÂë1
 761          {
 762   1              unsigned char i,n;
 763   1              ModeControl_1=0;//30M·¢Éä¹¦ÂÊ                           
 764   1              tran_en=1;
 765   1              myTxRxData[0]=CmdHead;
 766   1              myTxRxData[1]=MyAddress;
 767   1              myTxRxData[2]=ComMode_1;
 768   1      /*      myTxRxData[3]=0x00;
 769   1              myTxRxData[4]=0x00;
 770   1              myTxRxData[5]=0x00;
 771   1              myTxRxData[6]=0x00;
 772   1      */
 773   1              initsignal2();
 774   1      
 775   1              for(i=0;i<3;i++)
 776   1              {
 777   2                      for(n=0;n<8;n++)
 778   2                      {
 779   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 780   3                              {
 781   4                                      P10=0;
 782   4                                      Delay4(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 783   4                              }
 784   3                              else//Îª0µÄÇé¿ö
 785   3                              {
 786   4                                      P10=0;
 787   4                                      Delay4(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 788   4                              }
 789   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 790   3                              myTxRxData[i]<<=1;
 791   3                              Delay4(50);//ÑÓÊ±Òª´óÓÚ2ms
 792   3                      }
 793   2              }
 794   1              tran_en=0;
 795   1      }
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 14  

 796          
 797          void ComMode_3_Data()//·¢ËÍ±ßÂë3
 798          {
 799   1      //      unsigned int j;
 800   1              unsigned char i,n;
 801   1              ModeControl_1=1;//ÇĞ»»Îª300M·¢Éä
 802   1              tran_en=1;
 803   1              myTxRxData[0]=CmdHead;
 804   1              myTxRxData[1]=MyAddress;
 805   1              myTxRxData[2]=ComMode_3;
 806   1      /*      myTxRxData[3]=0x00;
 807   1              myTxRxData[4]=0x00;
 808   1              myTxRxData[5]=0x00;
 809   1              myTxRxData[6]=0x00;
 810   1      */
 811   1              initsignal();
 812   1      
 813   1              for(i=0;i<3;i++)
 814   1              {
 815   2                      for(n=0;n<8;n++)
 816   2                      {
 817   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 818   3                              {
 819   4                                      P10=0;
 820   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 821   4                              }
 822   3                              else//Îª0µÄÇé¿ö
 823   3                              {
 824   4                                      P10=0;
 825   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 826   4                              }
 827   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 828   3                              myTxRxData[i]<<=1;
 829   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 830   3                      }
 831   2              }
 832   1              tran_en=0;
 833   1      }
 834          
 835          void ComMode_4_Data()//·¢ËÍÌ§Æğ±àÂë
 836          {
 837   1              unsigned char i,n;
 838   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 839   1              tran_en=1;
 840   1              myTxRxData[0]=CmdHead;
 841   1              myTxRxData[1]=MyAddress;
 842   1              myTxRxData[2]=ComMode_4;
 843   1      /*      myTxRxData[3]=0x00;
 844   1              myTxRxData[4]=0x00;
 845   1              myTxRxData[5]=0x00;
 846   1              myTxRxData[6]=0x00;
 847   1      */
 848   1              initsignal();
 849   1      
 850   1              for(i=0;i<3;i++)
 851   1              {
 852   2                      for(n=0;n<8;n++)
 853   2                      {
 854   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 855   3                              {
 856   4                                      P10=0;
 857   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 15  

 858   4                              }
 859   3                              else//Îª0µÄÇé¿ö
 860   3                              {
 861   4                                      P10=0;
 862   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 863   4                              }
 864   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 865   3                              myTxRxData[i]<<=1;
 866   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 867   3                      }
 868   2              }
 869   1              tran_en=0;
 870   1      }
 871          
 872          void ComMode_5_Data()//·¢ËÍµ¹µØ±àÂë
 873          {
 874   1              unsigned char i,n;
 875   1              ModeControl_1=0;//ÇĞ»»Îª300M·¢Éä
 876   1              tran_en=1;      //´ò¿ªÎŞÏß·¢Éä»ú
 877   1              myTxRxData[0]=CmdHead;
 878   1              myTxRxData[1]=MyAddress;
 879   1              myTxRxData[2]=ComMode_5;
 880   1      /*      myTxRxData[3]=0x00;
 881   1              myTxRxData[4]=0x00;
 882   1              myTxRxData[5]=0x00;
 883   1              myTxRxData[6]=0x00;
 884   1      */
 885   1              initsignal();
 886   1      
 887   1              for(i=0;i<3;i++)
 888   1              {
 889   2                      for(n=0;n<8;n++)
 890   2                      {
 891   3                              if((myTxRxData[i]&0x80)==0x80)//Îª1
 892   3                              {
 893   4                                      P10=0;
 894   4                                      Delay3(120);//ÑÓÊ±4.5msÒÔÉÏ£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 895   4                              }
 896   3                              else//Îª0µÄÇé¿ö
 897   3                              {
 898   4                                      P10=0;
 899   4                                      Delay3(80);//ÑÓÊ±2ms£¬ÓÉÓÚ¶¨Ê±Æ÷Õ¼ÓÃÎÊÌâ£¬Ö»ÄÜÓÃÕâÖÖÑÓÊ±À´ÊµÏÖ
 900   4                              }
 901   3                              P10=1;//³£Ì¬Îª¸ßµçÆ½
 902   3                              myTxRxData[i]<<=1;
 903   3                              Delay3(50);//ÑÓÊ±Òª´óÓÚ2ms
 904   3                      }
 905   2              }
 906   1              tran_en=0;
 907   1      }
 908          
 909          void verifybattery()
 910          {                                                                         
 911   1              if((Check>=0x3a3))//ÉèÖÃ±È½ÏµçÑ¹£¬´Ë´¦ÒÔ4.96VÎª»ù×¼£¬´óÓÚ47.4V£¨4.5V£©
 912   1              {
 913   2                      PAshutdown=1;
 914   2                      SC_Speech(6);   //4VµçÁ¿³ä×ãÌáÊ¾
 915   2                      Delay(130);
 916   2                      PAshutdown=0;
 917   2              }
 918   1          else if((Check<0x3a0)&&(Check>=0x37c))              //Ğ¡ÓÚ47.4£¬´óÓÚ45£¨4.31V£©
 919   1              {
C51 COMPILER V9.51   NEWHOST                                                               09/26/2013 16:26:23 PAGE 16  

 920   2                      PAshutdown=1;
 921   2                      SC_Speech(5);  //3.8VµçÁ¿³ä×ãÌáÊ¾
 922   2                      Delay(130);
 923   2                      PAshutdown=0;
 924   2              }
 925   1              else if((Check<0x378)&&(Check>=0x359))           //Ğ¡ÓÚ45£¬´óÓÚ43£¨4.14V£©
 926   1              {
 927   2                      PAshutdown=1;
 928   2                      SC_Speech(4);  //3.6VµçÁ¿³ä×ãÌáÊ¾
 929   2                      Delay(130);
 930   2                      PAshutdown=0;
 931   2              }
 932   1              else if((Check<0x355)&&(Check>=0x327))           //Ğ¡ÓÚ43£¬´óÓÚ40£¨3.9V£©
 933   1              {
 934   2                      PAshutdown=1;
 935   2                      SC_Speech(3);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 936   2                      Delay(130);
 937   2                      PAshutdown=0;
 938   2              }
 939   1              else if((Check<0x323)&&(Check>=0x304))            //Ğ¡ÓÚ40£¬´óÓÚ38£¨3.73V£©
 940   1              {
 941   2                      PAshutdown=1;
 942   2                      SC_Speech(2);  //µÍÓÚ3.6vµçÁ¿³ä×ãÌáÊ¾
 943   2                      Delay(130);
 944   2                      PAshutdown=0;
 945   2              }
 946   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1697    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     46      12
   IDATA SIZE       =   ----    ----
   BIT SIZE         =     33    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
